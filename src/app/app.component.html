<!--BEGIN LICENSE BLOCK--> 
<!--Interneuron Terminus

Copyright(C) 2021  Interneuron CIC

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.If not, see<http://www.gnu.org/licenses/>. -->
<!--END LICENSE BLOCK--> 
<div style="min-height: 200px;">
  <div class="card-header">
    <strong>Warnings</strong>
    <span class="float-right" *ngIf="showNewWarnings">
      {{warningService.overrideNewWarning.length}} High
      severity /{{warningService.otherNewWarning.length}} Other</span>
    <div class="spinner-border spinner-border-sm ml-1" *ngIf="warningService.loader">
      <div role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <span class="float-right" *ngIf="showExistingWarnings">{{warningService.overrideExistingWarning.length}}
      High severity /{{warningService.otherExistingWarning.length}} Other</span>

  </div>

  <div class="d-flex justify-content-center"
    *ngIf="!warningService.loader && warningService.newWarnings.length==0 && warningService.existingWarnigns.length==0">
    <b class="text-info">There are no warnings</b>
  </div>
  <div class="card-body modal-bodytemp">
    <ul *ngIf="showExistingWarnings" class="alert-danger small">
      <li class="pt-1"  *ngFor="let err of warningService.existingerrors">
        <div class="row">
          <div class="col-11">
            <b> {{err.primarymedicationname}}</b> -
            <span [innerHtml]="err.message"></span>
          </div>
        </div>
      </li>

    </ul>
    <ul *ngIf="showNewWarnings" class="alert-danger">
      <li class="pt-1"  *ngFor="let err of warningService.newerrors">
        <div class="row">
          <div class="col-11">
            <b> {{err.primarymedicationname}}</b> -
            <span [innerHtml]="err.message"></span>
          </div>
        </div>
      </li>

    </ul>
    <ul class="list-group list-group-flush">
      <div *ngIf="showExistingWarnings">
        <li class="list-group-item" *ngFor="let w of warningService.overrideExistingWarning">
          <div class="row">
            <div class="col-1 custom-col-1">
              <div class="warning-img"></div>
            </div>
            <div class="col-11">
              <b> <span *ngIf="w.warningtype">{{GetWarningDisplay(w)}}</span></b> -
              <b>{{DisplayPrimaryMedicationName(w)}}</b>
              <span [innerHtml]="w.message"></span>
            </div>
          </div>
          <div class="row" *ngIf="w.overriderequired">
            <div class="col-1 custom-col-1">

            </div>
            <div class="col-11" style="display: flex;">
              <span *ngIf="w.overriderequired==true" style="min-width: 120px;" class="h6">Override reason: </span><input
                [disabled]="warningService.loader==true || !appService.AuthoriseAction('epma_override_warning') || !enableOverride" type="text" (change)="saveComments(w)"
                [(ngModel)]="w.overridemessage" name="overridemessage"
                
                [ngClass]="{'form-control-warning-red': !w.overridemessage, 'form-control-warning' : w.overridemessage }" />
            </div>
          </div>
        </li>
      </div>
      <div *ngIf="showNewWarnings">
        <li class="list-group-item" *ngFor="let w of warningService.overrideNewWarning">
          <div class="row">
            <div class="col-1 custom-col-1">
              <div class="warning-img"></div>
            </div>
            <div class="col">
              <b><span *ngIf="w.warningtype">{{GetWarningDisplay(w)}}</span></b> -
              <b>{{DisplayPrimaryMedicationName(w)}}</b>
              <span [innerHtml]="w.message"></span>
            </div>
          </div>
          <div class="row" *ngIf="w.overriderequired">
            <div class="col-1 custom-col-1"></div>
            <div class="col" style="display: flex;">
              <span *ngIf="w.overriderequired==true" style="min-width: 110px;" class="h6">Override reason: </span><input
                type="text" [(ngModel)]="w.overridemessage" *ngIf="appService.AuthoriseAction('epma_override_warning')"
                
                [ngClass]="{'form-control-warning-red': !w.overridemessage, 'form-control-warning' : w.overridemessage }"
                (change)="updateCommentStatus(w)" />
            </div>
          </div>
        </li>
      </div>



    </ul>
    <a class="text-primary"
      *ngIf="(showNewWarnings && warningService.otherNewWarning.length>0) || (showExistingWarnings && warningService.otherExistingWarning.length>0)"
      style="cursor:pointer;" (click)="ToggleShowLowPriorityWarnings()">
      <span *ngIf="!showAllwarning">Show all warnings</span>
      <span *ngIf="showAllwarning">Hide all warnings</span></a>
    <div *ngIf="showAllwarning">
      <ul class="list-group list-group-flush">
        <div *ngIf="showExistingWarnings">
          <li class="list-group-item" *ngFor="let w of warningService.otherExistingWarning">
            <b>{{GetWarningDisplay(w)}}</b> -
            <b>{{DisplayPrimaryMedicationName(w)}}</b>
            <span [innerHtml]="w.message"></span>
          </li>

        </div>
        <div *ngIf="showNewWarnings">
          <li class="list-group-item" *ngFor="let w of warningService.otherNewWarning">
            <b>{{GetWarningDisplay(w)}}</b> -
            <b>{{DisplayPrimaryMedicationName(w)}}</b>
            <span [innerHtml]="w.message"></span>
          </li>

        </div>

      </ul>
    </div>
  </div>
</div>